{"version":3,"sources":["/prj/user/Main.tonyu","/prj/user/Mirror.tonyu","/prj/user/MyChar.tonyu","/prj/user/WS.tonyu"],"names":[],"mappings":"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","sourcesContent":["native window;\nnative WebSite;\n\nupdateEx(5);\n\n//var host = window.document.location.host.replace(/:.*/, '');\nvar host = \"t2ws.mkbcr.net\";\n\nif(WebSite.isNW){\n    $port=58888;\n    $connectURL=\"localhost\";\n}else{\n    $port=443;\n    $connectURL=host;\n}\n// $InputBox.useNative=true;\n// $connectURL=$InputBox.prompt(\"URL\",host+\":58889\");\n\n$pad=new Pad{buttonCnt:4,alpha:255,active:false};\n$pad.alpha=0;\n$ws=new WS;\nnew MyChar;\n\n$latency=\"\";\nwhile(true){\n    if(getkey(1)==0&&$touches[0].touched==1){\n        $pad.alpha=255;\n        $pad.active=true;\n    }\n    // drawTextEx{x:$screenWidth-2,y:2,text:\"latency:\"+$latency+\"ms\",size:16,align:\"right\"};\n    drawText($screenWidth-2-200,2,\"ping:\"+$latency+\"ms\",\"rgb(255,255,255)\",16);\n    update();\n}","\nwhile(true){\n    alpha = playerNo==$myNo ? 64 : 255;\n    // 通信がしばらく来なかったら透明にする\n    if (otime >= 60*20) alpha *= (60*30-otime)/(60*10);\n    if (alpha <= 0) {\n        alpha = 0;\n    } else {\n        // drawTextEx{x,y:y+16,text:playerNo+\"P\",size:16,align:\"center\"};\n        drawText(x-12,y+16,(playerNo+1)+\"P\",\"rgb(255,255,255)\",16);\n    }\n    otime++;\n    update();\n}","native JSON;\nnative performance;\n\notime=$frameCount-60*5+30;\nx=rnd($screenWidth);\ny=rnd($screenHeight);\nox=x;\noy=y;\nalpha=255;\nwhile(true){\n    if($myNo!=null)p=$myNo;else p=$pat_base+11;\n    if(getkey(37)||$pad.getLeft() )x-=3;\n    if(getkey(38)||$pad.getUp()   )y-=3;\n    if(getkey(39)||$pad.getRight())x+=3;\n    if(getkey(40)||$pad.getDown() )y+=3;\n    x=clamp(16,$screenWidth-16,x);\n    y=clamp(16,$screenHeight-32,y);\n    if(x!=ox||y!=oy||$frameCount-otime>=60*5){\n        ox=x;\n        oy=y;\n        otime=$frameCount;\n        var o={\n            mes:\"playerXY\",\n            time:performance.now(),\n            playerNo:$myNo,\n            x,\n            y\n        };\n        $ws.send(JSON.stringify(o)); // 自分の位置情報を送信する\n    }\n    update();\n}\n\n\n","native WebSocket;\r\nnative performance;\r\nnative console;\r\nnative JSON;\r\n\r\n// WebSocketAPI(JavaScriptのAPI)\r\nvar url = \"wss://\"+$connectURL+\":\"+$port;\r\nprint(url);\r\nsock = new WebSocket(url);\r\nsock.addEventListener(\"open\", \\(e){\r\n    print(\"open\", e);\r\n});\r\nsock.addEventListener(\"message\", \\(e){\r\n    // print(\"message\", e.data);\r\n    recvProc(e.data);\r\n});\r\nsock.addEventListener(\"close\", \\(e){\r\n    print(\"close\", e);\r\n});\r\nsock.addEventListener(\"error\", \\(e){\r\n    print(\"error\", e);\r\n});\r\n\r\n$mirrorAry=[];\r\n\r\n\\send(d){\r\n    if (sock.readyState==1) { // WebSocket.OPEN\r\n        sock.send(d);\r\n    }\r\n}\r\n\\recvProc(d){\r\n    var obj = JSON.parse(d);\r\n    \r\n    if (obj.mes==\"_start\"){ // 通信開始時の情報\r\n        $myNo=obj.playerNo;\r\n        print(\"myNo:\"+($myNo+1)+\"P\");\r\n        \r\n    } else if (obj.mes==\"_close\"){ // 誰かが切断した\r\n        var m=$mirrorAry[obj.playerNo];\r\n        if (m) {\r\n            m.otime=60*25;\r\n        }\r\n        print(\"close:\", (obj.playerNo+1)+\"P\");\r\n        \r\n    } else if (obj.mes==\"_ping\"){ // 通信が生きているかの確認がサーバーからくるので返す\r\n        var o={mes:\"_ping\"};\r\n        send(JSON.stringify(obj));\r\n        \r\n    } else if (obj.mes==\"playerXY\"){ // ゲームの情報（あるキャラの位置）\r\n        var playerNo=obj.playerNo;\r\n        if (playerNo==null) return;\r\n        var m=$mirrorAry[playerNo];\r\n        if (!m) {\r\n            print(\"connect:\", (playerNo+1)+\"P\");\r\n            m=new Mirror{playerNo,x:-999,y:-999,p:playerNo,zOrder:10,otime:0};\r\n            $mirrorAry[playerNo]=m;\r\n        }\r\n        m.x = obj.x;\r\n        m.y = obj.y;\r\n        m.otime = 0;\r\n        if (playerNo==$myNo) { // ラグを計算\r\n            $latency = floor(performance.now() - obj.time);\r\n        }\r\n    }\r\n}\r\n\r\n"]}